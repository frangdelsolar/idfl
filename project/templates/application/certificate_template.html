<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sustainability Certification - {{ application.name }}</title>
    <style>
      @page {
        size: letter;
        margin: 1in;
      }
      body {
        font-family: "Helvetica", "Arial", sans-serif;
        line-height: 1.6;
        color: #333;
        max-width: 8.5in;
        margin: 0 auto;
        padding: 20px;
      }
      .header {
        text-align: center;
        border-bottom: 3px solid #2e8b57;
        padding-bottom: 20px;
        margin-bottom: 30px;
      }
      .certificate-title {
        font-size: 28px;
        font-weight: bold;
        color: #2e8b57;
        margin-bottom: 10px;
      }
      .status-badge {
        display: inline-block;
        padding: 8px 20px;
        border-radius: 20px;
        font-weight: bold;
        margin: 15px 0;
        font-size: 18px;
      }
      .status-approved {
        background-color: #4caf50;
        color: white;
      }
      .status-rejected {
        background-color: #f44336;
        color: white;
      }
      .company-info {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 25px;
        border-left: 4px solid #2e8b57;
      }
      .section {
        margin-bottom: 30px;
      }
      .section-title {
        font-size: 20px;
        font-weight: bold;
        color: #2e8b57;
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 8px;
        margin-bottom: 15px;
      }
      .approved-items {
        background-color: #f0fff4;
        padding: 15px;
        border-radius: 6px;
        border-left: 4px solid #4caf50;
        margin-bottom: 20px;
      }
      .rejected-items {
        background-color: #fff5f5;
        padding: 15px;
        border-radius: 6px;
        border-left: 4px solid #f44336;
        margin-bottom: 20px;
      }
      .item {
        margin-bottom: 12px;
        padding: 10px;
        background: white;
        border-radius: 4px;
        border: 1px solid #e9ecef;
      }
      .item-approved {
        border-left: 3px solid #4caf50;
      }
      .item-rejected {
        border-left: 3px solid #f44336;
      }
      .item-name {
        font-weight: bold;
        margin-bottom: 5px;
      }
      .item-details {
        color: #666;
        font-size: 14px;
        margin-bottom: 5px;
      }
      .rejection-reason {
        color: #d32f2f;
        font-style: italic;
        background-color: #ffebee;
        padding: 8px;
        border-radius: 4px;
        margin-top: 5px;
        font-size: 14px;
      }
      .footer {
        text-align: center;
        margin-top: 40px;
        padding-top: 20px;
        border-top: 2px solid #e9ecef;
        color: #666;
        font-size: 14px;
      }
      .timestamp {
        color: #999;
        font-size: 14px;
        text-align: right;
        margin-bottom: 20px;
      }
      .no-items {
        color: #999;
        font-style: italic;
        text-align: center;
        padding: 20px;
      }
    </style>
  </head>
  <body>
    <div class="timestamp">Generated on: {{ generation_date }}</div>

    <div class="header">
      <div class="certificate-title">Sustainability Certification Document</div>
      <div style="font-size: 18px; color: #666">Application Review Results</div>

      {% if application.status == 'completed' %}
      <div class="status-badge status-approved">✓ APPLICATION APPROVED</div>
      {% else %}
      <div class="status-badge status-rejected">✗ APPLICATION REJECTED</div>
      {% endif %}
    </div>

    <div class="company-info">
      <h3 style="margin-top: 0; color: #2e8b57">Applicant Information</h3>
      <p><strong>Company:</strong> {{ application.company_info.name }}</p>
      <p><strong>Application:</strong> {{ application.name }}</p>
      <p>
        <strong>Submitted:</strong> {{ application.submission_date|date:"F j, Y" }}
      </p>
      {% if application.description %}
      <p><strong>Description:</strong> {{ application.description }}</p>
      {% endif %}
    </div>

    <!-- Approved Items Section -->
    <div class="section">
      <div class="section-title">✓ Approved Components</div>

      {% if approved_company_info or approved_partners or approved_products %}
      <!-- Approved Company Info -->
      {% if approved_company_info %}
      <div class="approved-items">
        <h4 style="color: #4caf50; margin-top: 0">Company Information</h4>
        {% for item in approved_company_info %}
        <div class="item item-approved">
          <div class="item-name">{{ item.name }}</div>
          <div class="item-details">
            {{ item.address }}, {{ item.city }}, {{ item.state }} {{ item.zip_code }}, {{ item.country }}
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Approved Supply Chain Partners -->
      {% if approved_partners %}
      <div class="approved-items">
        <h4 style="color: #4caf50; margin-top: 0">
          Approved Supply Chain Partners
        </h4>
        {% for partner in approved_partners %}
        <div class="item item-approved">
          <div class="item-name">{{ partner.name }}</div>
          <div class="item-details">
            {{ partner.address }}, {{ partner.city }}, {{ partner.state }} {{ partner.zip_code }}, {{ partner.country }}
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Approved Products -->
      {% if approved_products %}
      <div class="approved-items">
        <h4 style="color: #4caf50; margin-top: 0">Approved Products</h4>
        {% for product in approved_products %}
        <div class="item item-approved">
          <div class="item-name">{{ product.product_name }}</div>
          <div class="item-details">
            <strong>Category:</strong> {{ product.product_category }}<br />
            <strong>Manufacturer:</strong> {{ product.supply_chain_partner_name_raw }}<br />
            <strong>Materials:</strong> {{ product.raw_materials_list }}
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %} 
      {% else %}
      <div class="no-items">No approved components</div>
      {% endif %}
    </div>

    <!-- Rejected Items Section -->
    <div class="section">
      <div class="section-title">✗ Rejected Components</div>

      {% if rejected_company_info or rejected_partners or rejected_products %}
      <!-- Rejected Company Info -->
      {% if rejected_company_info %}
      <div class="rejected-items">
        <h4 style="color: #f44336; margin-top: 0">Company Information</h4>
        {% for item in rejected_company_info %}
        <div class="item item-rejected">
          <div class="item-name">{{ item.name }}</div>
          <div class="item-details">
            {{ item.address }}, {{ item.city }}, {{ item.state }} {{ item.zip_code }}, {{ item.country }}
          </div>
          {% if item.rejection_reason %}
          <div class="rejection-reason">
            <strong>Reason:</strong> {{ item.rejection_reason }}
          </div>
          {% endif %}
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Rejected Supply Chain Partners -->
      {% if rejected_partners %}
      <div class="rejected-items">
        <h4 style="color: #f44336; margin-top: 0">
          Rejected Supply Chain Partners
        </h4>
        {% for partner in rejected_partners %}
        <div class="item item-rejected">
          <div class="item-name">{{ partner.name }}</div>
          <div class="item-details">
            {{ partner.address }}, {{ partner.city }}, {{ partner.state }} {{ partner.zip_code }}, {{ partner.country }}
          </div>
          {% if partner.rejection_reason %}
          <div class="rejection-reason">
            <strong>Reason:</strong> {{ partner.rejection_reason }}
          </div>
          {% endif %}
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Rejected Products -->
      {% if rejected_products %}
      <div class="rejected-items">
        <h4 style="color: #f44336; margin-top: 0">Rejected Products</h4>
        {% for product in rejected_products %}
        <div class="item item-rejected">
          <div class="item-name">{{ product.product_name }}</div>
          <div class="item-details">
            <strong>Category:</strong> {{ product.product_category }}<br />
            <strong>Manufacturer:</strong> {{ product.supply_chain_partner_name_raw }}<br />
            <strong>Materials:</strong> {{ product.raw_materials_list }}
          </div>
          {% if product.rejection_reason %}
          <div class="rejection-reason">
            <strong>Reason:</strong> {{ product.rejection_reason }}
          </div>
          {% endif %}
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Overall Application Rejection Reason -->
      {% if application.status == 'rejected' and application.rejection_reason %}
      <div class="rejected-items">
        <h4 style="color: #f44336; margin-top: 0">Overall Application Notes</h4>
        <div class="rejection-reason" style="margin: 0">
          {{ application.rejection_reason }}
        </div>
      </div>
      {% endif %} 
      {% else %}
      <div class="no-items">No rejected components</div>
      {% endif %}
    </div>

    <div class="footer">
      <p>
        This document was automatically generated by the Sustainability
        Certification System.
      </p>
      <p>
        Application ID: {{ application.id }} | Reference: {{ application.name|slice:":20" }}...
      </p>
    </div>
  </body>
</html>